{% extends "base.html" %}
{% load static %}

{% block title %}Search Doctor{% endblock %}

{% block extra_css %}
<style>
    .search-card {
        border-radius: 14px;
    }

    .doctor-card img {
        height: 220px;
        object-fit: cover;
    }

    .doctor-card {
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        border-radius: 14px;
    }

    .doctor-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0,0,0,0.12);
    }

    .badge-special {
        background-color: #e7f1ff;
        color: #0d6efd;
    }
</style>
{% endblock %}

{% block content %}
<div class="container my-5">

    <!-- Page Title -->
    <div class="text-center mb-4">
        <h2 class="fw-bold">Find Your Doctor</h2>
        <p class="text-muted">Search by name, city, or specialization</p>
    </div>

    <!-- Search Box -->
    <div class="card shadow-sm search-card mb-5">
        <div class="card-body p-4">
            <div class="row g-3">
                <div class="col-md-4">
                    <input type="text" id="doctorName" class="form-control"
                           placeholder="üë®‚Äç‚öïÔ∏è Doctor name">
                </div>

                <div class="col-md-4">
                    <input type="text" id="city" class="form-control"
                           placeholder="üìç City">
                </div>

                <div class="col-md-4">
                    <input type="text" id="specialization" class="form-control"
                           placeholder="ü©∫ Specialization">
                </div>

                <div class="col-12">
                    <button class="btn btn-primary w-100 py-2"
                            onclick="searchDoctors()">
                        üîç Search Doctors
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Doctor Results -->
    <div class="row" id="doctor-list"></div>

</div>
{% endblock %}

{% block extra_js %}
<script>
function searchDoctors() {

    const name = document.getElementById("doctorName").value.trim();
    const city = document.getElementById("city").value.trim();
    const specialization = document.getElementById("specialization").value.trim();

    if (!name && !city && !specialization) {
        alert("Please enter at least one search field");
        return;
    }

    const params = new URLSearchParams({
        name: name,
        city: city,
        specialization: specialization
    });

    fetch(`/appointments/api/doctors/search/?${params.toString()}`)
        .then(response => response.json())
        .then(data => {

            let html = "";

            if (data.length === 0) {
                html = `
                    <div class="col-12 text-center text-muted">
                        <h5>No doctors found üòî</h5>
                    </div>
                `;
            }

            data.forEach(doc => {
                html += `
                    <div class="col-lg-4 col-md-6 mb-4">
                        <div class="card doctor-card h-100 shadow-sm">

                            <img src="${doc.profile_image || 'https://via.placeholder.com/300x220?text=No+Image'}"
                                 class="card-img-top">

                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title fw-bold">${doc.name}</h5>

                               <span class="badge rounded-pill badge-special mb-2 px-3 py-2">
                                    ${doc.specialization}
                                </span>

                                <p class="card-text small text-muted mb-3">
                                    ${doc.qualification}<br>
                                    ${doc.experience_years} years experience<br>
                                    ${doc.clinic_name}, ${doc.city}
                                </p>

                                <div class="mt-auto">
                                    <p class="fw-semibold mb-2">
                                        Consultation Fee: ‚Çπ${doc.consultation_fee}
                                    </p>

                                    <a href="/appointments/book/${doc.id}/"
                                       class="btn btn-outline-primary w-100">
                                        Book Appointment
                                    </a>
                                </div>
                            </div>

                        </div>
                    </div>
                `;
            });

            document.getElementById("doctor-list").innerHTML = html;
        })
        .catch(error => {
            console.error("Error:", error);
        });
}
</script>
{% endblock %}
